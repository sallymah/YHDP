[main] 20200611 10:03:11 WARN  DBService            L:794  - DBCP borrow connection time: 6109 ms. batch
[main] 20200611 10:03:11 WARN  ExpTrnBlklist        L:118  - seqnoSql: SELECT LPAD(NVL(TO_CHAR(TO_NUMBER(MAX(SEQNO)) + 1), '01'), 2, '0') FROM TB_OUTCTL WHERE MEM_ID = '00001001' AND FILE_NAME = 'BLKLIST' AND FILE_DATE = '20200611'
[main] 20200611 10:03:11 INFO  ExpTrnBlklist        L:130  - memIds:[00001001]
[main] 20200611 10:03:11 INFO  ExpTrnBlklist        L:131  - memId2Seqno:{00001001=01}
[main] 20200611 10:03:11 INFO  AbstractBatchBasic   L:109  - begin running
[main] 20200611 10:03:11 DEBUG TbBatchResultMgr     L:60   - sql: INSERT INTO TB_BATCH_RESULT(PROGRAM_NAME, START_DATE, START_TIME, END_DATE, END_TIME, WORK_FLAG, RCODE, ERROR_DESC, PAR_MON, PAR_DAY, LINK_CONTROL, JOB_ID, JOB_TIME, MEM_ID, RECOVER_VALUE) VALUES ('ExpTrnBlklist', '20200611', '100311', '', '', '0', '0000', '', '06', '11', 'N', '000', '000000', '', '')
[main] 20200611 10:03:11 DEBUG TbBatchResultMgr     L:64   - TB_BATCH_RESULT: 1 record inserted
[main] 20200611 10:03:11 DEBUG TbBatchResultMgr     L:65   - [TbBatchResultInfo  sProgramName:ExpTrnBlklist sStartDate:20200611 sStartTime:100311 sEndDate: sEndTime: sWorkFlag:0 sRcode:0000 sErrorDesc: sParMon:06 sParDay:11 sLinkControl:N sJobId:000 sJobTime:000000 sMemId: sRecoverValue:]
[main] 20200611 10:03:11 INFO  ExpTrnBlklist        L:209  - SELECT  MIFARE_UL_UID, REG_DATE FROM( SELECT CARD_NO, BLACKLIST_CODE, BLOCK_DATE, MIFARE_UL_UID, REG_DATE, APRV_USERID FROM( SELECT CARD_NO, BLACKLIST_CODE, BLOCK_DATE, MIFARE_UL_UID, REG_DATE, APRV_USERID FROM( SELECT CARD_NO, BLACKLIST_CODE, BLOCK_DATE, MIFARE_UL_UID, REG_DATE, APRV_USERID FROM( SELECT CARD_NO, BLACKLIST_CODE, BLOCK_DATE, MIFARE_UL_UID, REG_DATE, APRV_USERID FROM( SELECT CARD_NO, BLACKLIST_CODE, BLOCK_DATE, MIFARE_UL_UID, REG_DATE, APRV_USERID FROM( SELECT A1.CARD_NO,BLACKLIST_CODE,B1.MIFARE_UL_UID,B1.REG_DATE , '' AS BLOCK_DATE, '' AS APRV_USERID FROM ( SELECT TB_BLACKLIST_VER.CARD_NO, TB_BLACKLIST_VER.BLACKLIST_CODE, BLOCK_DATE, REG_DATE FROM TB_BLACKLIST_VER,TB_BLACKLIST_SETTING WHERE VERNO = (SELECT MAX(VERNO)CARD_NO FROM TB_BLACKLIST_VER) AND TB_BLACKLIST_SETTING.CARD_NO = TB_BLACKLIST_VER.CARD_NO)A1, (SELECT CARD_NO, MIFARE_UL_UID,REG_DATE  FROM TB_CARD WHERE MIFARE_UL_UID IS NOT NULL AND LENGTH(MIFARE_UL_UID)=8 AND MIFARE_UL_UID <>'00000000' )B1 WHERE A1.CARD_NO = B1.CARD_NO )WHERE BLACKLIST_CODE <> '03' ) WHERE BLOCK_DATE IS NOT NULL AND REG_DATE <= 20180611)WHERE BLACKLIST_CODE <> '04' OR (BLACKLIST_CODE = '04' AND REG_DATE <= 20200604)  )B WHERE ( BLACKLIST_CODE <> '01' OR  APRV_USERID  <> 'CRM')  AND (BLACKLIST_CODE = '01' AND  APRV_USERID  = 'CRM' AND (CARD_NO NOT IN( SELECT CARD_NO FROM TB_CARD_BAL WHERE TB_CARD_BAL.CARD_NO= B.CARD_NO AND CR_BONUS_QTY - DB_BONUS_QTY + BAL_BONUS_QTY = 0) OR REG_DATE <= 20190611))) WHERE BLACKLIST_CODE <> '05' OR (BLACKLIST_CODE = '05' AND REG_DATE <=20170611) )A WHERE NOT EXISTS (SELECT * FROM TB_BAL_TRANSFER_DTL WHERE A.CARD_NO = TB_BAL_TRANSFER_DTL.ORIG_BALANCE_ID AND TB_BAL_TRANSFER_DTL.ORIG_BALANCE_ID LIKE '9%' AND BONUS_QTY = 0) OR (EXISTS (SELECT * FROM TB_BAL_TRANSFER_DTL WHERE A.CARD_NO = TB_BAL_TRANSFER_DTL.ORIG_BALANCE_ID AND TB_BAL_TRANSFER_DTL.ORIG_BALANCE_ID LIKE '9%' AND BONUS_QTY = 0) AND REG_DATE <=  20210611) AND ROWNUM <= 100000 ORDER BY REG_DATE ASC 
[main] 20200611 10:03:11 INFO  ExpTrnBlklist        L:209  - SELECT  MIFARE_UL_UID, REG_DATE FROM( SELECT CARD_NO, BLACKLIST_CODE, BLOCK_DATE, MIFARE_UL_UID, REG_DATE, APRV_USERID FROM( SELECT CARD_NO, BLACKLIST_CODE, BLOCK_DATE, MIFARE_UL_UID, REG_DATE, APRV_USERID FROM( SELECT CARD_NO, BLACKLIST_CODE, BLOCK_DATE, MIFARE_UL_UID, REG_DATE, APRV_USERID FROM( SELECT CARD_NO, BLACKLIST_CODE, BLOCK_DATE, MIFARE_UL_UID, REG_DATE, APRV_USERID FROM( SELECT CARD_NO, BLACKLIST_CODE, BLOCK_DATE, MIFARE_UL_UID, REG_DATE, APRV_USERID FROM( SELECT A1.CARD_NO,BLACKLIST_CODE,B1.MIFARE_UL_UID,B1.REG_DATE , '' AS BLOCK_DATE, '' AS APRV_USERID FROM ( SELECT TB_BLACKLIST_VER.CARD_NO, TB_BLACKLIST_VER.BLACKLIST_CODE, BLOCK_DATE, REG_DATE FROM TB_BLACKLIST_VER,TB_BLACKLIST_SETTING WHERE VERNO = (SELECT MAX(VERNO)CARD_NO FROM TB_BLACKLIST_VER) AND TB_BLACKLIST_SETTING.CARD_NO = TB_BLACKLIST_VER.CARD_NO)A1, (SELECT CARD_NO, MIFARE_UL_UID,REG_DATE  FROM TB_CARD WHERE MIFARE_UL_UID IS NOT NULL AND LENGTH(MIFARE_UL_UID)=8 AND MIFARE_UL_UID <>'00000000' )B1 WHERE A1.CARD_NO = B1.CARD_NO )WHERE BLACKLIST_CODE <> '03' ) WHERE BLOCK_DATE IS NOT NULL AND REG_DATE <= 20180611)WHERE BLACKLIST_CODE <> '04' OR (BLACKLIST_CODE = '04' AND REG_DATE <= 20200604)  )B WHERE ( BLACKLIST_CODE <> '01' OR  APRV_USERID  <> 'CRM')  AND (BLACKLIST_CODE = '01' AND  APRV_USERID  = 'CRM' AND (CARD_NO NOT IN( SELECT CARD_NO FROM TB_CARD_BAL WHERE TB_CARD_BAL.CARD_NO= B.CARD_NO AND CR_BONUS_QTY - DB_BONUS_QTY + BAL_BONUS_QTY = 0) OR REG_DATE <= 20190611))) WHERE BLACKLIST_CODE <> '05' OR (BLACKLIST_CODE = '05' AND REG_DATE <=20170611) )A WHERE NOT EXISTS (SELECT * FROM TB_BAL_TRANSFER_DTL WHERE A.CARD_NO = TB_BAL_TRANSFER_DTL.ORIG_BALANCE_ID AND TB_BAL_TRANSFER_DTL.ORIG_BALANCE_ID LIKE '9%' AND BONUS_QTY = 0) OR (EXISTS (SELECT * FROM TB_BAL_TRANSFER_DTL WHERE A.CARD_NO = TB_BAL_TRANSFER_DTL.ORIG_BALANCE_ID AND TB_BAL_TRANSFER_DTL.ORIG_BALANCE_ID LIKE '9%' AND BONUS_QTY = 0) AND REG_DATE <=  20210611) AND ROWNUM <= 100000 ORDER BY REG_DATE ASC 
[main] 20200611 10:03:11 DEBUG TbFileInfoMgr        L:253  - sql: SELECT ROWID, FILE_NAME, IN_OUT, FILE_TYPE, DATA_LEN, FILE_NAME_PATTERN, LOCAL_PATH, UPT_USERID, UPT_DATE, UPT_TIME, APRV_USERID, APRV_DATE, APRV_TIME, OK_FLAG, SUB_FILE_NAME, RETURN_FILE_NAME, CIPHER_FLAG, KEY_WORD FROM TB_FILE_INFO WHERE FILE_NAME = 'BLKLIST' AND IN_OUT = 'O'
[main] 20200611 10:03:11 DEBUG TbFileInfoMgr        L:266  - TB_FILE_INFO: 1 records exist
[main] 20200611 10:03:11 DEBUG TbFileInfoMgr        L:267  - [TbFileInfoPK  sFileName:BLKLIST sInOut:O]
[main] 20200611 10:03:11 DEBUG TbOutctlMgr          L:272  - sql: SELECT ROWID, MEM_ID, FILE_NAME, FILE_DATE, SEQNO, FILE_TYPE, WORK_FLAG, TOT_REC, FILE_SIZE, FULL_FILE_NAME, PROGRAM_NAME, START_DATE, START_TIME, PAR_MON, PAR_DAY, SYS_DATE, SYS_TIME, MEM_GROUP_ID, MERCH_ID FROM TB_OUTCTL WHERE MEM_ID = '00001001' AND FILE_NAME = 'BLKLIST' AND FILE_DATE = '20200611' AND SEQNO = '01'
[main] 20200611 10:03:11 DEBUG TbOutctlMgr          L:285  - TB_OUTCTL: 0 records exist
[main] 20200611 10:03:11 DEBUG TbOutctlMgr          L:286  - [TbOutctlPK  sMemId:00001001 sFileName:BLKLIST sFileDate:20200611 sSeqno:01]
[main] 20200611 10:03:11 DEBUG BatchUtils           L:56   - 4
[main] 20200611 10:03:11 DEBUG BatchUtils           L:117  - xorData: -28
[main] 20200611 10:03:11 DEBUG ExpTrnBlklist        L:270  - ISOUtil.hexString(xorData): E4
[main] 20200611 10:03:11 DEBUG ExpTrnBlklist        L:274  - unixTime: 1591869784
[main] 20200611 10:03:11 DEBUG BatchUtils           L:56   - 4
[main] 20200611 10:03:11 DEBUG TbOutctlMgr          L:60   - sql: INSERT INTO TB_OUTCTL(MEM_ID, FILE_NAME, FILE_DATE, SEQNO, FILE_TYPE, WORK_FLAG, TOT_REC, FILE_SIZE, FULL_FILE_NAME, PROGRAM_NAME, START_DATE, START_TIME, PAR_MON, PAR_DAY, SYS_DATE, SYS_TIME, MEM_GROUP_ID, MERCH_ID) VALUES ('00001001', 'BLKLIST', '20200611', '01', 'B', '1', 0, 36, 'BLKLIST202006110001.DAT', 'ExpTrnBlklist', '20200611', '100311', '06', '11', '20200611', '100311', '', '')
[main] 20200611 10:03:11 DEBUG TbOutctlMgr          L:64   - TB_OUTCTL: 1 record inserted
[main] 20200611 10:03:11 DEBUG TbOutctlMgr          L:65   - [TbOutctlInfo  sMemId:00001001 sFileName:BLKLIST sFileDate:20200611 sSeqno:01 sFileType:B sWorkFlag:1 sTotRec:0 sFileSize:36 sFullFileName:BLKLIST202006110001.DAT sProgramName:ExpTrnBlklist sStartDate:20200611 sStartTime:100311 sParMon:06 sParDay:11 sSysDate:20200611 sSysTime:100311 sMemGroupId: sMerchId:]
[main] 20200611 10:03:12 DEBUG TbBatchResultMgr     L:147  - sql: UPDATE TB_BATCH_RESULT SET END_DATE = '20200611', END_TIME = '100312', WORK_FLAG = '1', RCODE = '0000', ERROR_DESC = '', PAR_MON = '06', PAR_DAY = '11', LINK_CONTROL = 'O', MEM_ID = '', RECOVER_VALUE = '' WHERE PROGRAM_NAME = 'ExpTrnBlklist' AND START_DATE = '20200611' AND START_TIME = '100311' AND JOB_ID = '000' AND JOB_TIME = '000000'
[main] 20200611 10:03:12 DEBUG TbBatchResultMgr     L:151  - TB_BATCH_RESULT: 1 record updated
[main] 20200611 10:03:12 DEBUG TbBatchResultMgr     L:152  - [TbBatchResultInfo  sProgramName:ExpTrnBlklist sStartDate:20200611 sStartTime:100311 sEndDate:20200611 sEndTime:100312 sWorkFlag:1 sRcode:0000 sErrorDesc: sParMon:06 sParDay:11 sLinkControl:O sJobId:000 sJobTime:000000 sMemId: sRecoverValue:]
[main] 20200611 10:03:12 INFO  AbstractBatchBasic   L:150  - end running

